<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>米哈遊課金CP值計算器</title>
    <meta name="description" content="使用這個工具來計算米哈遊遊戲中的課金性價比。快速簡單！">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            position: relative;
        }
        h1 {
            text-align: center;
            color: #2196F3;
            margin-bottom: 40px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #2196F3;
            color: white;
        }
        .checkbox-container {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            align-items: center;
        }
        .checkbox-container label {
            margin-left: 5px;
        }
        .discount-column {
            max-width: 60px;
            width: 60px;
            text-align: center;
        }
        .discount-column input {
            max-width: 50px;
            width: 100%;
            box-sizing: border-box;
        }
        input[type="number"] {
            width: 80px;
            padding: 5px;
            margin-left: 10px;
        }
        #drawSettings {
            display: none; /* 默认隐藏 */
        }
        .toggle-button {
            margin-top: 20px;
            display: block;
            text-align: center;
            padding: 10px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .toggle-button:hover {
            background-color: #1976D2;
        }
    </style>
</head>
<body>
<h1>課金CP值計算器</h1>
<div class="checkbox-container">
    <input type="checkbox" id="doubleStonesCheckbox" onchange="toggleDoubleStones()">
    <label for="doubleStonesCheckbox">首儲</label>
</div>
<table>
    <thead>
    <tr>
        <th rowspan="2">石頭</th>
        <th rowspan="2">台幣</th>
        <th rowspan="2">日幣</th>
        <th rowspan="2">日幣轉台幣</th>
        <th rowspan="2" class="discount-column">折價後</th>
        <th colspan="3">一顆石頭價格</th>
    </tr>
    <tr>
        <th>台幣</th>
        <th>日幣</th>
        <th>折價後</th>
    </tr>
    </thead>
    <tbody id="stoneTable">
        <!-- 数据行会通过JS插入 -->
    </tbody>
</table>
<div style="margin-top: 20px; text-align: center;">
    <label for="globalYenToNtRate">請輸入日幣轉台幣匯率:</label>
    <input type="number" value="0.2" step="0.01" id="globalYenToNtRate" oninput="calculatePrices()">
</div>
<!-- 控制显示和隐藏的按钮 -->
<button class="toggle-button" onclick="toggleDrawSettings()">顯示抽數價格</button>
<!-- 抽數和價格信息 -->
<div id="drawSettings">
    <table>
        <thead>
        <tr>
            <th rowspan="2">石頭</th>
            <th colspan="3" id="drawPriceHeader">幾抽價格</th>
        </tr>
        <tr>
            <th>台幣</th>
            <th>日幣</th>
            <th>折價後</th>
        </tr>
        </thead>
        <tbody id="xDrawPriceTable">
            <!-- x抽價格行将通过JS插入 -->
        </tbody>
    </table>
    <div style="margin-top: 20px; text-align: center;">
        <label for="drawCount">請輸入抽數:</label>
        <input type="number" value="10" step="1" min="1" id="drawCount" oninput="calculatePrices()">
    </div>
</div>
<script>
    const stoneData = [
        { stoneCount: 8080, ntPrice: 3290, yenPrice: 12000 },
        { stoneCount: 3940, ntPrice: 1690, yenPrice: 6100 },
        { stoneCount: 2240, ntPrice: 990, yenPrice: 3680 },
        { stoneCount: 1090, ntPrice: 490, yenPrice: 1840 },
        { stoneCount: 300, ntPrice: 170, yenPrice: 610 },
        { stoneCount: 60, ntPrice: 33, yenPrice: 120 }
    ];

    // 初始化表格数据
    function initTable() {
        const tableBody = document.getElementById('stoneTable');
        tableBody.innerHTML = ''; // 清空表格內容
        stoneData.forEach((data, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td id="stoneCount-${index}">${data.stoneCount}</td>
                <td>${data.ntPrice}</td>
                <td>${data.yenPrice}</td>
                <td id="yenToNt-${index}"></td>
                <td class="discount-column"><input type="number" value="0" step="0.01" id="discountPrice-${index}" oninput="calculatePrices()"></td>
                <td id="ntPerStone-${index}"></td>
                <td id="yenPerStone-${index}"></td>
                <td id="discountPerStone-${index}"></td>
            `;
            tableBody.appendChild(row);
        });
        calculatePrices(); // 初始化时计算价格
    }

    // 计算每行的数据
    function calculatePrices() {
        const exchangeRate = parseFloat(document.getElementById('globalYenToNtRate').value) || 0;
        const drawCount = parseInt(document.getElementById('drawCount').value) || 10; // 获取自定义的抽数
        document.getElementById('drawPriceHeader').textContent = `${drawCount}抽價格`; // 更新表头
        
        const xDrawPriceTableBody = document.getElementById('xDrawPriceTable');
        xDrawPriceTableBody.innerHTML = ''; // 清空价格表格内容
        stoneData.forEach((data, index) => {
            let stoneCount = data.stoneCount;
            const ntPrice = data.ntPrice;
            const yenPrice = data.yenPrice;
            if (document.getElementById('doubleStonesCheckbox').checked) {
                stoneCount *= 2; // 如果选择双倍，则石头数量翻倍
            }
            const discountPrice = parseFloat(document.getElementById(`discountPrice-${index}`).value) || 0;
            const yenToNt = Math.round(yenPrice * exchangeRate);
            const ntPerStone = ntPrice / stoneCount;
            const yenPerStone = yenToNt / stoneCount;
            const discountPerStone = discountPrice / stoneCount || 0;
            // 更新一顆石頭價格表格中的计算结果
            document.getElementById(`stoneCount-${index}`).textContent = stoneCount;
            document.getElementById(`yenToNt-${index}`).textContent = yenToNt;
            document.getElementById(`ntPerStone-${index}`).textContent = ntPerStone.toFixed(3);
            document.getElementById(`yenPerStone-${index}`).textContent = yenPerStone.toFixed(3);
            document.getElementById(`discountPerStone-${index}`).textContent = discountPerStone.toFixed(3);
            
            // 计算 x 抽價格
            const requiredStones = drawCount * 160; // 根据输入的抽数动态计算所需的总石头数
            const xDrawNtPrice = Math.round(ntPerStone * requiredStones);
            const xDrawYenPrice = Math.round(yenPerStone * requiredStones);
            const xDrawDiscountPrice = Math.round(discountPerStone * requiredStones);
            // 更新 x 抽價格表格
            const xDrawRow = document.createElement('tr');
            xDrawRow.innerHTML = `
                <td>${stoneCount}</td>
                <td>${xDrawNtPrice}</td>
                <td>${xDrawYenPrice}</td>
                <td>${xDrawDiscountPrice || 0}</td>
            `;
            xDrawPriceTableBody.appendChild(xDrawRow);
        });
    }

    // 切换双倍石头属性
    function toggleDoubleStones() {
        calculatePrices();
    }

    // 控制抽數设置的显示和隐藏
    function toggleDrawSettings() {
        const drawSettings = document.getElementById('drawSettings');
        const button = document.querySelector('.toggle-button');
        const isHidden = drawSettings.style.display === 'none' || drawSettings.style.display === '';
        drawSettings.style.display = isHidden ? 'block' : 'none';
        button.textContent = isHidden ? '隱藏抽數價格' : '顯示抽數價格';
    }

    // 初始化表格
    initTable();
</script>
</body>
</html>

